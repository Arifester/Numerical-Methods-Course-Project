<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metode Secant</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='output.css') }}">
</head>

<body class="bg-gray-100 text-gray-800">

  <div class="relative bg-linear-to-bl from-blue-200 via-transparent">
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
      <div class="grid items-center md:grid-cols-2 gap-8 lg:gap-12">
        <div>
          <p
            class="inline-block text-sm font-medium bg-clip-text bg-linear-to-l from-blue-600 to-violet-500 text-transparent">
            Proyek Metode Numerik 2025
          </p>

          <div class="mt-4 md:mb-12 max-w-2xl">
            <h1 class="mb-4 font-semibold text-gray-800 text-4xl lg:text-5xl">
              Metode Secant
            </h1>
            <p class="text-gray-600">
              Metode Secant adalah metode numerik yang digunakan untuk mencari akar dari suatu fungsi. Metode ini
              merupakan
              pengembangan dari metode Newton-Raphson, namun tidak memerlukan turunan dari fungsi yang dicari akarnya.
              Metode ini menggunakan dua titik awal dan iterasi untuk mendekati akar fungsi.
            </p>
          </div>
          <blockquote class="hidden md:block relative max-w-sm">
            <svg class="absolute top-0 start-0 transform -translate-x-6 -translate-y-8 size-16 text-gray-200" width="16"
              height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path
                d="M7.39762 10.3C7.39762 11.0733 7.14888 11.7 6.6514 12.18C6.15392 12.6333 5.52552 12.86 4.76621 12.86C3.84979 12.86 3.09047 12.5533 2.48825 11.94C1.91222 11.3266 1.62421 10.4467 1.62421 9.29999C1.62421 8.07332 1.96459 6.87332 2.64535 5.69999C3.35231 4.49999 4.33418 3.55332 5.59098 2.85999L6.4943 4.25999C5.81354 4.73999 5.26369 5.27332 4.84476 5.85999C4.45201 6.44666 4.19017 7.12666 4.05926 7.89999C4.29491 7.79332 4.56983 7.73999 4.88403 7.73999C5.61716 7.73999 6.21938 7.97999 6.69067 8.45999C7.16197 8.93999 7.39762 9.55333 7.39762 10.3ZM14.6242 10.3C14.6242 11.0733 14.3755 11.7 13.878 12.18C13.3805 12.6333 12.7521 12.86 11.9928 12.86C11.0764 12.86 10.3171 12.5533 9.71484 11.94C9.13881 11.3266 8.85079 10.4467 8.85079 9.29999C8.85079 8.07332 9.19117 6.87332 9.87194 5.69999C10.5789 4.49999 11.5608 3.55332 12.8176 2.85999L13.7209 4.25999C13.0401 4.73999 12.4903 5.27332 12.0713 5.85999C11.6786 6.44666 11.4168 7.12666 11.2858 7.89999C11.5215 7.79332 11.7964 7.73999 12.1106 7.73999C12.8437 7.73999 13.446 7.97999 13.9173 8.45999C14.3886 8.93999 14.6242 9.55333 14.6242 10.3Z"
                fill="currentColor" />
            </svg>

            <div class="relative z-10">
              <p class="text-xl italic text-gray-800">
                Anggota Tim
              </p>
            </div>

            <div class="mt-3">
              <div class="flex items-start flex-col gap-x-4">

                <div class="flex items-center gap-x-4">
                  <div class="shrink-0">
                    <img class="size-8 rounded-full"
                      src="https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
                      alt="Avatar">
                  </div>
                  <div class="grow">
                    <div class="font-semibold text-gray-800">Muhammad Khuirul Huda</div>
                    <div class="text-xs text-gray-500">2304130046</div>
                  </div>
                </div>

                <div class="flex items-center gap-x-4">
                  <div class="shrink-0">
                    <img class="size-8 rounded-full"
                      src="https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
                      alt="Avatar">
                  </div>
                  <div class="grow">
                    <div class="font-semibold text-gray-800">Faisal Fahmi Yuliawan</div>
                    <div class="text-xs text-gray-500">2304130051</div>
                  </div>
                </div>

                <div class="flex items-center gap-x-4">
                  <div class="shrink-0">
                    <img class="size-8 rounded-full"
                      src="https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
                      alt="Avatar">
                  </div>
                  <div class="grow">
                    <div class="font-semibold text-gray-800">Muhammad Rifki Rifaldi</div>
                    <div class="text-xs text-gray-500">2304130052</div>
                  </div>
                </div>

                <div class="flex items-center gap-x-4">
                  <div class="shrink-0">
                    <img class="size-8 rounded-full"
                      src="https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
                      alt="Avatar">
                  </div>
                  <div class="grow">
                    <div class="font-semibold text-gray-800">Muhammad Firda Satria</div>
                    <div class="text-xs text-gray-500">2304130057</div>
                  </div>
                </div>

                <div class="flex items-center gap-x-4">
                  <div class="shrink-0">
                    <img class="size-8 rounded-full"
                      src="https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
                      alt="Avatar">
                  </div>
                  <div class="grow">
                    <div class="font-semibold text-gray-800">Arifudin</div>
                    <div class="text-xs text-gray-500">2304130061</div>
                  </div>
                </div>

              </div>
            </div>
          </blockquote>
          </div>
        <div>
          <form method="post" action="">
            <div class="lg:max-w-lg lg:mx-auto lg:me-0 ms-auto">
              <div class="p-4 sm:p-7 flex flex-col bg-white rounded-2xl shadow-lg">
                <div class="text-center">
                  <h1 class="block text-2xl font-bold text-gray-800">Masukkan Parameter</h1>
                  <p class="mt-2 text-sm text-gray-600">
                    Ingin mereset?
                    <a class="text-blue-600 decoration-2 hover:underline focus:outline-hidden focus:underline font-medium"
                      href="/">
                      Reset
                    </a>
                  </p>
                </div>

                <div class="mt-5">

                  <div class="grid grid-cols-2 gap-4">

                    <div class="relative col-span-full">
                      <div class="relative">
                        <input value="{{ request_form.get('function', '') }}" type="text" name="function" required
                          class="peer p-3 sm:p-4 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-transparent focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none
                            focus:pt-6
                            focus:pb-2
                            not-placeholder-shown:pt-6
                            not-placeholder-shown:pb-2
                            autofill:pt-6
                            autofill:pb-2" placeholder="********">
                        <label for="hs-hero-signup-form-floating-input-new-password" class="absolute top-0 start-0 p-3 sm:p-4 h-full text-sm truncate pointer-events-none transition ease-in-out duration-100 border border-transparent origin-[0_0] peer-disabled:opacity-50 peer-disabled:pointer-events-none
                            peer-focus:scale-90
                            peer-focus:translate-x-0.5
                            peer-focus:-translate-y-1.5
                            peer-focus:text-gray-500
                            peer-not-placeholder-shown:scale-90
                            peer-not-placeholder-shown:translate-x-0.5
                            peer-not-placeholder-shown:-translate-y-1.5
                            peer-not-placeholder-shown:text-gray-500">Fungsi f(x) (misal: x**2-1)</label>
                      </div>
                      </div>
                    <div>
                      <div class="relative">
                        <input value="{{ request_form.get('x0', '') }}" type="number" step="any" name="x0" id="x0"
                          required class="peer p-3 sm:p-4 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-transparent focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none
                            focus:pt-6
                            focus:pb-2
                            not-placeholder-shown:pt-6
                            not-placeholder-shown:pb-2
                            autofill:pt-6
                            autofill:pb-2" placeholder="you@email.com">
                        <label for="hs-hero-signup-form-floating-input-email" class="absolute top-0 start-0 p-3 sm:p-4 h-full text-sm truncate pointer-events-none transition ease-in-out duration-100 border border-transparent origin-[0_0] peer-disabled:opacity-50 peer-disabled:pointer-events-none
                            peer-focus:scale-90
                            peer-focus:translate-x-0.5
                            peer-focus:-translate-y-1.5
                            peer-focus:text-gray-500
                            peer-not-placeholder-shown:scale-90
                            peer-not-placeholder-shown:translate-x-0.5
                            peer-not-placeholder-shown:-translate-y-1.5
                            peer-not-placeholder-shown:text-gray-500">Tebakan Awal (x0)</label>
                      </div>
                      </div>
                    <div>
                      <div class="relative">
                        <input value="{{ request_form.get('x1', '') }}" type="number" step="any" name="x1" id="x1"
                          required class="peer p-3 sm:p-4 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-transparent focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none focus:pt-6
                            focus:pb-2
                            not-placeholder-shown:pt-6
                            not-placeholder-shown:pb-2
                            autofill:pt-6
                            autofill:pb-2" placeholder="Preline">
                        <label for="hs-hero-signup-form-floating-input-company-name" class="absolute top-0 start-0 p-3 sm:p-4 h-full text-sm truncate pointer-events-none transition ease-in-out duration-100 border border-transparent origin-[0_0] peer-disabled:opacity-50 peer-disabled:pointer-events-none
                            peer-focus:scale-90
                            peer-focus:translate-x-0.5
                            peer-focus:-translate-y-1.5
                            peer-focus:text-gray-500
                            peer-not-placeholder-shown:scale-90
                            peer-not-placeholder-shown:translate-x-0.5
                            peer-not-placeholder-shown:-translate-y-1.5
                            peer-not-placeholder-shown:text-gray-500">Tebakan Awal (x1)</label>
                      </div>
                      </div>
                    <div class="relative col-span-full">
                      <div class="relative">
                        <input min="1" value="{{ request_form.get('tol', '4')}}" type="number" name="tol" required class="peer p-3 sm:p-4 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-transparent focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none
                            focus:pt-6
                            focus:pb-2
                            not-placeholder-shown:pt-6
                            not-placeholder-shown:pb-2
                            autofill:pt-6
                            autofill:pb-2" placeholder="********">
                        <label for="hs-hero-signup-form-floating-input-new-password" class="absolute top-0 start-0 p-3 sm:p-4 h-full text-sm truncate pointer-events-none transition ease-in-out duration-100 border border-transparent origin-[0_0] peer-disabled:opacity-50 peer-disabled:pointer-events-none
                            peer-focus:scale-90
                            peer-focus:translate-x-0.5
                            peer-focus:-translate-y-1.5
                            peer-focus:text-gray-500
                            peer-not-placeholder-shown:scale-90
                            peer-not-placeholder-shown:translate-x-0.5
                            peer-not-placeholder-shown:-translate-y-1.5
                            peer-not-placeholder-shown:text-gray-500">Angka Benar</label>
                      </div>
                      </div>
                    <div class="col-span-full">
                      <div class="relative">
                        <input min="1" value="{{ request_form.get('max_iter', '10')}}" type="number" name="max_iter"
                          required class="peer p-3 sm:p-4 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-transparent focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none
                            focus:pt-6
                            focus:pb-2
                            not-placeholder-shown:pt-6
                            not-placeholder-shown:pb-2
                            autofill:pt-6
                            autofill:pb-2" placeholder="********">
                        <label for="hs-hero-signup-form-floating-input-current-password" class="absolute top-0 start-0 p-3 sm:p-4 h-full text-sm truncate pointer-events-none transition ease-in-out duration-100 border border-transparent origin-[0_0] peer-disabled:opacity-50 peer-disabled:pointer-events-none
                            peer-focus:scale-90
                            peer-focus:translate-x-0.5
                            peer-focus:-translate-y-1.5
                            peer-focus:text-gray-500
                            peer-not-placeholder-shown:scale-90
                            peer-not-placeholder-shown:translate-x-0.5
                            peer-not-placeholder-shown:-translate-y-1.5
                            peer-not-placeholder-shown:text-gray-500">Maksimal iterasi</label>
                      </div>
                      </div>
                    </div>
                  <div class="mt-5">
                    <button type="submit"
                      class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-hidden focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">Kalkulasi</button>
                  </div>
                </div>
              </div>
              </div>
          </form>
          </div>
        </div>
      <div
        class="mt-6 md:mt-12 py-3 flex items-center text-sm text-gray-800 gap-x-1.5 after:flex-1 after:border-t after:border-gray-200 after:ms-6">
        <span
          class="font-semibold bg-clip-text bg-linear-to-l from-blue-600 to-violet-500 text-transparent">Hasil kalkulasi</span>
        akan muncul di bawah ini
      </div>

    </div>
    </div>
  {% if error %}
  <div class="flex items-center justify-center mt-4 mb-4"> <div class="bg-red-50 border-s-4 border-red-500 p-4 w-full max-w-3xl" role="alert" tabindex="-1" aria-labelledby="hs-bordered-red-style-label"> <div class="flex">
        <div class="shrink-0">
          <span class="inline-flex justify-center items-center size-8 rounded-full border-4 border-red-100 bg-red-200 text-red-800 ">
            <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"></path>
              <path d="m6 6 12 12"></path>
            </svg>
          </span>
          </div>
        <div class="ms-3">
          <h3 id="hs-bordered-red-style-label" class="text-gray-800 font-semibold ">
            Ups!
          </h3>
          <p class="text-sm text-gray-700 ">
            {{ error }}
          </p>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {% if results and (not error) %} {# Ensure results exist and no overriding error message #}
    {# Get the display precision from the form data passed back #}
    {% set display_precision = request_form.get('tol')|int %}
    <div class="max-w-3xl mx-auto p-6 bg-white rounded-2xl shadow-lg mt-10 mb-10"> {# Added margin bottom #}
      <div class="mt-6">
        <h2 class="text-xl font-bold mb-2">Hasil Iterasi:</h2>
        <div class="border-gray-200 border overflow-x-auto"> {# Added overflow-x-auto for smaller screens #}
          <table class="table-auto w-full text-left border border-gray-300 min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Iterasi</th>
                <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">x</th>
                <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">f(x)</th>
                <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Error</th>
              </tr>
            </thead>
            <tbody>
              {% for r in results %}
              <tr class="divide-y divide-gray-200">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">{{ r.iter }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">{{ ('%.' ~ display_precision ~ 'f')|format(r.x) }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">{{ ('%.' ~ display_precision ~ 'f')|format(r.f_x) }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">
                  {% if r.error == 'N/A' %}
                  N/A
                  {% else %}
                  {{ ('%.' ~ display_precision ~ 'f')|format(r.error) }}
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="mt-6">
        <h2 class="text-xl font-bold mb-2">Grafik Hasil Iterasi:</h2>
        <canvas id="resultChart" width="400" height="200"></canvas>
      </div>
    </div>
  {% endif %}

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const iterationsForChart = {{ iterations_chart | tojson }};
    const xValuesForChart = {{ x_values_chart | tojson }};
    const fxValuesForChart = {{ fx_values_chart | tojson }};
    const errorsForChart = {{ errors_chart | tojson }}; // Data error yang sudah dipadding

    if (iterationsForChart && iterationsForChart.length > 0) {
      const ctx = document.getElementById('resultChart').getContext('2d');
      const labels = iterationsForChart.map(iter => `Iterasi ${iter}`);

      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Nilai x',
              data: xValuesForChart,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              fill: false,
              tension: 0.1,
              yAxisID: 'y-axis-main' // Menggunakan sumbu Y utama
            },
            {
              label: 'f(x)',
              data: fxValuesForChart,
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              fill: false,
              tension: 0.1,
              yAxisID: 'y-axis-main' // Menggunakan sumbu Y utama
            },
            {
              label: 'Error (|x_baru - x_lama|)', // Label untuk grafik konvergensi
              data: errorsForChart, // Data error yang sudah dipadding
              borderColor: 'rgba(255, 159, 64, 1)', // Warna oranye
              backgroundColor: 'rgba(255, 159, 64, 0.2)',
              fill: false,
              tension: 0.1,
              yAxisID: 'y-axis-error' // Menggunakan sumbu Y sekunder untuk error
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { // Pengaturan interaksi untuk tooltip
            mode: 'index',
            intersect: false,
          },
          stacked: false, // Pastikan grafik tidak ditumpuk
          plugins: { // Pengaturan plugin seperti judul dan legenda
            title: {
                display: true,
                text: 'Grafik Hasil Iterasi dan Konvergensi Error'
            },
            legend: {
                position: 'top',
            }
          },
          scales: { // Pengaturan sumbu
            x: {
                title: {
                    display: true,
                    text: 'Iterasi'
                }
            },
            'y-axis-main': { // Sumbu Y utama untuk Nilai x dan f(x)
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'Nilai x / f(x)'
              }
            },
            'y-axis-error': { // Sumbu Y sekunder untuk Error
              type: 'linear', // Bisa juga 'logarithmic' jika error sangat kecil atau bervariasi besar
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'Error'
              },
              grid: {
                drawOnChartArea: false, // Agar grid error tidak tumpang tindih dengan grid utama
              },
              ticks: {
                 // Anda bisa menambahkan callback untuk format angka error jika perlu
                 // contoh: mengonversi ke notasi ilmiah jika angkanya sangat kecil
                // callback: function(value, index, values) {
                //    if (value === null) return null; // Jaga null tetap null
                //    return value.toExponential(2);
                // }
              }
            }
          }
        }
      });
    }
  </script>
</body>

</html>