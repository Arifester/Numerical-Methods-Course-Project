<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Metode Secant</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- File CSS Lokal -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-6 bg-white shadow-lg mt-10 rounded-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">Metode Secant</h1>

    <form method="POST" class="space-y-4">
      <div>
        <label class="block font-semibold">Fungsi f(x)</label>
        <input value="{{ request_form.get('function', '') }}" type="text" name="function" required class="input border rounded-md p-2 w-full" placeholder="Contoh: x**2 - 2">
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Tebakan Awal x0</label>
          <input value="{{ request_form.get('x0', '') }}" type="number" step="any" name="x0" required class="input border rounded-md p-2 w-full">
        </div>
        <div>
          <label class="block font-semibold">Tebakan Awal x1</label>
          <input value="{{ request_form.get('x1', '') }}" type="number" step="any" name="x1" required class="input border rounded-md p-2 w-full">
        </div>
      </div>
      <div>
        <label class="block font-semibold">Angka Benar</label>
        <input value="{{ request_form.get('tol', '')}}" type="number" name="tol" required class="input border rounded-md p-2 w-full" min="1">
      </div>
      <div>
        <label class="block font-semibold">Maksimal Iterasi</label>
        <input value="{{ request_form.get('max_iter', '')}}"  type="number" name="max_iter" required class="input border rounded-md p-2 w-full" min="1">
      </div>
      <button type="submit" class="btn bg-blue-500 text-white rounded-md p-2 w-full hover:bg-blue-600 transition">Hitung</button>
    </form>

    {% if error %}
      <div class="mt-4 text-red-500 font-semibold">{{ error }}</div>
    {% endif %}

    {% if results %}
      <div class="mt-6">
        <h2 class="text-xl font-bold mb-2">Hasil Iterasi:</h2>
        <table class="table-auto w-full text-left border border-gray-300">
          <thead>
            <tr>
              <th class="px-4 py-2 border">Iterasi</th>
              <th class="px-4 py-2 border">x</th>
              <th class="px-4 py-2 border">f(x)</th>
              <th class="px-4 py-2 border">Error</th>
            </tr>
          </thead>
          <tbody>
            {% for r in results %}
            <tr class="border-t">
              <td class="px-4 py-2">{{ r.iter }}</td>
              <td class="px-4 py-2">{{ '%.9f'|format(r.x) }}</td>
              <td class="px-4 py-2">{{ '%.9f'|format(r.f_x) }}</td>
              <td class="px-4 py-2">{{ '%.9f'|format(r.error) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Area untuk Grafik -->
      <div class="mt-6">
        <h2 class="text-xl font-bold mb-2">Grafik Hasil Iterasi:</h2>
        <canvas id="resultChart" width="400" height="200"></canvas>
      </div>
    {% endif %}
  </div>

  <!-- File JS Lokal -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    // Script untuk menggambar grafik jika ada hasil
    const results = {{ results|tojson }};
    if (results.length > 0) {
      const ctx = document.getElementById('resultChart').getContext('2d');
      const labels = results.map(r => `Iterasi ${r.iter}`);
      const dataX = results.map(r => r.x);
      const dataF = results.map(r => r.f_x);

      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Nilai x',
              data: dataX,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              fill: true,
              tension: 0.1
            },
            {
              label: 'f(x)',
              data: dataF,
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              fill: true,
              tension: 0.1
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    }
  </script>
</body>
</html>
